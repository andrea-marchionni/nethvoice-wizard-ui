<div class="wizard-pf">
  <div class="wizard-pf-body clearfix">
    <div class="wizard-pf-steps">
      <ul class="wizard-pf-steps-indicator">
        <li class="wizard-pf-step {{resolveActiveTab('cards',2) ? 'active' : ''}}" data-tabgroup="1">
          <a ng-click="goTo('apps/cards')"><span class="wizard-pf-step-number">1</span><span class="wizard-pf-step-title">{{'Customer cards' | translate}}</span></a>
        </li>
      </ul>
    </div>
  </div>
  <!-- SOURCES -->
  <div class="wizard-pf-contents adjust-size">
    <h1 class="control-label centered" for="textInput-markup">{{'Customer cards configuration' | translate}}</h1>
    <h3 ng-if="!(allSources | isEmpty)">{{'Sources' | translate}}</h3>
    <div ng-if="onSaveSuccessSource" class="alert alert-success alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
        <span class="pficon pficon-close"></span>
        </button>
      <span class="pficon pficon-ok"></span>
      <strong>{{'Source saved' | translate}}.</strong> {{'Source saved with success' | translate}}
    </div>
    <div ng-if="onSaveErrorSource" class="alert alert-danger alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
        <span class="pficon pficon-close"></span>
        </button>
      <span class="pficon pficon-error-circle-o"></span>
      <strong>{{'Source not saved' | translate}}.</strong> {{'Source saving error' | translate}}
    </div>
    <div ng-if="!(allSources | isEmpty)" class="row row-cards-pf adjust-card">
      <div ng-repeat="g in allSources | orderBy:'name'" class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <div class="card-pf">
          <h2 class="card-pf-title">
            <span class="pficon pficon-volume"></span> {{g.name}} <span class="right-only small-font">{{getDBName(g.type)}}</span>
          </h2>
          <div class="card-pf-body">
            <div class="progress-description full-size-max">
              {{'Database address' | translate}} <span class="right-only"><strong>{{g.host}}</strong></span>
            </div>
            <div class="progress-description full-size-max">
              {{'Database port' | translate}} <span class="right-only"><strong>{{g.port}}</strong></span>
            </div>
            <div class="progress-description full-size-max">
              {{'Database user' | translate}} <span class="right-only"><strong>{{g.user}}</strong></span>
            </div>
            <div class="progress-description full-size-max">
              {{'Database password' | translate}} <span class="right-only"><strong>{{g.pass}}</strong></span>
            </div>
            <div class="progress progress-xs progress-label-top-right">
              <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"
                style="width: 100%;" data-toggle="tooltip" title="100% Used">
              </div>
            </div>
          </div>
          <div class="card-pf-footer">
            <div class="card-pf-time-frame-filter">
              <div ng-show="g.onSave" class="spinner spinner-sm adjust-margin spinner-right"></div>
            </div>
            <p>
              <button data-toggle="modal" data-target="#newSourceModal" ng-click="modifySource(g)" class="btn btn-primary" type="button">{{'Modify' | translate}}</button>
              <button ng-click="deleteSource(g)" class="btn btn-danger" type="button">{{'Delete' | translate}}</button>
            </p>
          </div>
        </div>
      </div>
    </div>
    <button ng-click="cancelSource()" ng-if="!(allSources | isEmpty)" data-toggle="modal" data-target="#newSourceModal" class="btn btn-primary btn-lg right-only">{{'Create new source' | translate}}</button>
    <div ng-if="allSources | isEmpty" class="blank-slate-pf ">
      <div class="blank-slate-pf-icon">
        <span class="pficon pficon-volume"></span>
      </div>
      <h1>
        {{'No sources found' | translate}}
      </h1>
      <div class="blank-slate-pf-main-action">
        <button ng-click="cancelSource()" data-toggle="modal" data-target="#newSourceModal" class="btn btn-primary btn-lg">{{'Create new source' | translate}}</button>
      </div>
    </div>
    <!-- END SOURCES -->
    <div class="divider"></div>
    <!-- CUSTOMER CARDS -->
    <h3 ng-if="!(allCards | isEmpty)">{{'Customer cards' | translate}}</h3>
    <div ng-if="onSaveSuccessCard" class="alert alert-success alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
        <span class="pficon pficon-close"></span>
        </button>
      <span class="pficon pficon-ok"></span>
      <strong>{{'Card saved' | translate}}.</strong> {{'Card saved with success' | translate}}
    </div>
    <div ng-if="onSaveErrorCard" class="alert alert-danger alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
        <span class="pficon pficon-close"></span>
        </button>
      <span class="pficon pficon-error-circle-o"></span>
      <strong>{{'Card not saved' | translate}}.</strong> {{'Card saving error' | translate}}
    </div>
    <div ng-if="!(allCards | isEmpty)" class="row row-cards-pf adjust-card">
      <div ng-repeat="g in allCards | orderBy:'name'" class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <div class="card-pf">
          <h2 class="card-pf-title">
            <span class="fa fa-calendar-o"></span> {{g.name}} <span class="right-only small-font"><span class="pficon pficon-volume"></span>            {{getSourceName(g.source)}}</span>
            </span>
          </h2>
          <div class="card-pf-body">
            <div class="progress-description full-size-max">
              {{'Query' | translate}}
              <div readonly class="editor" ng-model="g.query" ui-ace="{theme:'twilight', mode: 'sql'}"></div>
            </div>
          </div>
          <div class="card-pf-footer">
            <div class="card-pf-time-frame-filter">
              <div ng-show="g.onSave" class="spinner spinner-sm adjust-margin spinner-right"></div>
            </div>
            <p>
              <button data-toggle="modal" data-target="#newCardModal" ng-click="modifyCard(g)" class="btn btn-primary" type="button">{{'Modify' | translate}}</button>
              <button ng-click="deleteCard(g)" class="btn btn-danger" type="button">{{'Delete' | translate}}</button>
            </p>
          </div>
        </div>
      </div>
    </div>
    <button ng-if="!(allCards | isEmpty)" ng-click="cancelCard()" data-toggle="modal" data-target="#newCardModal" class="btn btn-primary btn-lg right-only">{{'Create new card' | translate}}</button>
    <div ng-if="allCards | isEmpty" class="blank-slate-pf ">
      <div class="blank-slate-pf-icon">
        <span class="fa fa-calendar-o"></span>
      </div>
      <h1>
        {{'No cards found' | translate}}
      </h1>
      <div class="blank-slate-pf-main-action">
        <button ng-click="cancelCard()" data-toggle="modal" data-target="#newCardModal" class="btn btn-primary btn-lg">{{'Create new card' | translate}}</button>
      </div>
    </div>
  </div>
  <!-- END CUSTOMER CARDS -->
</div>
</div>
<div class="modal fade" id="newSourceModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          <span class="pficon pficon-close"></span>
        </button>
        <h4 class="modal-title" id="myModalLabel">{{'New source' | translate}}</h4>
      </div>
      <form class="form-horizontal" ng-submit="newSource.verified ? saveSource(newSource) : undefined">
        <div class="modal-body">
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Database type' | translate}}</label>
            <div class="col-sm-9">
              <select required title="-" pf-select="{ width: '180px' }" ng-model="newSource.type" ng-options="p.type as p.name for p in allDBTypes">
            </select></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Database name' | translate}}</label>
            <div class="col-sm-9">
              <input required ng-model="newSource.name" type="text" id="textInput-modal-markup" class="form-control profile-new-name"></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Database address' | translate}}</label>
            <div class="col-sm-9">
              <input required ng-model="newSource.host" type="text" id="textInput-modal-markup" class="form-control profile-new-name"></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Database port' | translate}}</label>
            <div class="col-sm-9">
              <input required ng-model="newSource.port" type="text" id="textInput-modal-markup" class="form-control profile-new-name"></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Database user' | translate}}</label>
            <div class="col-sm-9">
              <input required ng-model="newSource.user" type="text" id="textInput-modal-markup" class="form-control profile-new-name"></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Database password' | translate}}</label>
            <div class="col-sm-9">
              <input required ng-model="newSource.pass" type="password" id="textInput-modal-markup" class="form-control profile-new-name"></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Connection' | translate}}</label>
            <div class="col-sm-9">
              <button ng-click="checkConnection(newSource)" class="btn btn-primary {{newSource.type && newSource.name && newSource.port ? '' : 'disabled'}}"
                type="button">{{'Check' | translate}}</button>
              <div ng-show="newSource.isChecking" class="spinner spinner-sm inline-display language-name check-connection"></div>
              <span ng-show="!newSource.isChecking && newSource.checked && newSource.verified" class="pficon pficon-ok check-status"></span>
              <span ng-show="!newSource.isChecking && newSource.checked && !newSource.verified" class="pficon pficon-error-circle-o check-status"></span>
            </div>
          </div>
          <div ng-show="newSource.onSave" class="spinner spinner-sm adjust-margin loader-modal-profile"></div>
          <div class="modal-footer submit">
            <button ng-click="cancelSource(newSource)" type="button" class="btn btn-default" data-dismiss="modal">{{'Cancel' | translate}}</button>
            <button type="submit" class="btn btn-primary {{newSource.verified ? '' : 'disabled'}}">{{'Save' | translate}}</button>
          </div>
      </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="newCardModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          <span class="pficon pficon-close"></span>
        </button>
        <h4 class="modal-title" id="myModalLabel">{{'New card' | translate}}</h4>
      </div>
      <form class="form-horizontal" ng-submit="newCard.query.length > 0 ? saveCard(newCard) : undefined">
        <div class="modal-body">
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Name' | translate}}</label>
            <div class="col-sm-9">
              <input required ng-model="newCard.name" type="text" id="textInput-modal-markup" class="form-control profile-new-name"></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Source' | translate}}</label>
            <div class="col-sm-9">
              <select required title="-" pf-select="{ width: '180px' }" ng-model="newCard.source" ng-options="p.id as p.name for p in allSources">
            </select></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-modal-markup">{{'Query' | translate}}</label>
            <div class="col-sm-9">
              <div required ng-model="newCard.query" class="editor-form" ui-ace="{theme:'twilight',mode: 'sql', onChange: editorOnChange}"></div>
            </div>
          </div>
          <div ng-show="newCard.onSave" class="spinner spinner-sm adjust-margin loader-modal-profile"></div>
          <div class="modal-footer submit">
            <button ng-click="cancelCard(newCard)" type="button" class="btn btn-default" data-dismiss="modal">{{'Cancel' | translate}}</button>
            <button type="submit" class="btn btn-primary {{newCard.query.length > 0 ? '' : 'disabled'}}">{{'Save' | translate}}</button>
          </div>
      </form>
      </div>
    </div>
  </div>
</div>
