<div class="wizard-pf">
  <div class="wizard-pf-body clearfix">
    <div class="wizard-pf-steps">
      <ul class="wizard-pf-steps-indicator">
        <li class="wizard-pf-step {{resolveActiveTab('bulkextensions',2) ? 'active' : ''}}" data-tabgroup="1">
          <a ng-click="goTo('apps/bulkextensions')"><span class="wizard-pf-step-number">1</span><span class="wizard-pf-step-title">{{'Bulk extensions' | translate}}</span></a>
        </li>
      </ul>
    </div>
  </div>
  <div class="wizard-pf-contents adjust-size no-margin-bottom">
    <h1 class="control-label centered" for="textInput-markup">{{'Bulk extensions configuration' | translate}}</h1>
    <div ng-if="!(users | isEmpty)" class="container-fluid">
      <div class="row margin-top-lg">
        <div class="col-sm-9 no-padding">
          <div class="filter-label-bulk">{{'Select' | translate}}:</div>
          <div class="dropdown inline-display">
            <button class="btn btn-default dropdown-toggle drd-button" type="button" id="dropdownMenu1" data-toggle="dropdown">
              <span class="filter-option pull-left">
                -
              </span>
              <span class="caret drd-carret"></span>
            </button>
            <ul class="dropdown-menu drd-ul" role="menu" aria-labelledby="dropdownMenu1">
              <li><a ng-click="selectAll(true)">{{'All' | translate}}</a></li>
              <li><a id="intervalButton" data-toggle="modal" data-target="#setInterval">{{'Interval' | translate}}</a></li>
              <li ng-if="!(allGroups | isEmpty)" class="divider"></li>
              <li ng-repeat="group in allGroups"><a ng-click="selectGroup(group.id)">{{'Group' | translate}} {{group.name}}</a></li>
              <li ng-if="!(allGroups | isEmpty)" class="divider"></li>
              <li><a ng-click="selectAll(false)">{{'None' | translate}}</a></li>
            </ul>
          </div>
          <button ng-click="initEditModal()" class="btn btn-default inline-display">
            {{'Edit' | translate}}
          </button>
        </div>
        <div class="col-sm-3 label-selected-bulk no-padding">
          <strong>{{num.selected}}</strong> {{'of' | translate}} <strong>{{num.tot}}</strong> {{'selected' | translate}}
        </div>
      </div>
      <form role="form" class="search-pf has-button adjust-form" id="form-lg-domains-details">
        <div class="form-group has-clear">
          <div class="search-pf-input-group" id="filter-domains-details">
            <input ng-model="search.string" type="text" class="form-control input-lg" placeholder="{{'Search users' | translate}}..."></input>
          </div>
        </div>
        <div class="form-group">
          <button class="btn btn-default btn-lg" type="submit">
            <span class="fa fa-search"></span>
          </button>
        </div>
      </form>
      <div class="check-results">
      <a ng-if="(search.string  + '').length >= 2 && (users | filter:search.string) != '' && !search.result" ng-click="selectResults(search.string)"> {{'Select search results' | translate}}</a>
      <a ng-if="(search.string  + '').length >= 2 && (users | filter:search.string) != '' && search.result" ng-click="selectResults(search.string)"> {{'Deselect search results' | translate}}</a>
      </div>
      <div class="form-group config-row-button">
        </div>
      <div class="list-group list-view-pf list-view-pf-view adjust-margin-extensions margin-bottom-lg">
        <div ng-if="user.default_extension !== 'none'" class="list-group-item {{user.selected == true ? 'selected' : ''}}" ng-repeat="user in users | filter:search.string" ng-click="selectUser(user)">
          <div class="list-view-pf-actions {{user.alreadyExists ? 'has-error' : ''}}">
            <div ng-show="user.isInAction" class="spinner spinner-sm adjust-margin"></div>
            <span ng-show="!user.isInAction" popover-placement="top-right" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{user.default_extension === 'none' ? 'Not configured' : 'Configured' | translate}}"
              class="pficon {{user.default_extension === 'none' ? 'pficon-info' : 'pficon-ok'}} icon-med"></span>
            <span ng-if="user.alreadyExists" class="help-block">{{'Extension already in use' | translate}}</span>
          </div>
          <div class="list-view-pf-checkbox">
            <input type="checkbox" ng-click="user.selected == true ? user.selected = false : user.selected = true" ng-model="user.selected" ng-disabled="user.default_extension === 'none'">
          </div>
          <div class="list-view-pf-main-info">
            <div class="list-view-pf-left">
              <span class="fa fa-user list-view-pf-icon-sm {{user.default_extension === 'none' ? 'disabled' : ''}}"></span>
            </div>
            <div class="list-view-pf-body">
              <div class="list-view-pf-description">
                <div class="list-group-item-heading {{user.default_extension === 'none' ? 'disabled' : ''}}">{{user.username}}</div>
                <div class="list-group-item-text">
                  <span class="{{user.default_extension === 'none' ? 'disabled' : ''}}">{{user.displayname}}</span>
                </div>
              </div>
              <div class="list-view-pf-additional-info">
                <div ng-if="user.default_extension === 'none'" class="list-view-pf-additional-info-item {{user.alreadyExists ? 'has-error' : ''}}">
                  <form class="full-size" ng-submit="setMainExtension(user)">
                    <input ng-model="user.temp_ext" type="text" class="form-control" id="filter" placeholder="{{'Insert extension' | translate}}">
                  </form>
                  <div class="input-group-btn">
                    <button ng-click="setMainExtension(user)" type="button" class="btn btn-default" aria-haspopup="true" aria-expanded="false">{{'Add' | translate}}</button>
                  </div>
                </div>
                <div ng-if="user.default_extension !== 'none'" class="list-view-pf-additional-info-item">
                  <b>
                    {{user.default_extension}}
                  </b>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div ng-if="users | isEmpty" class="blank-slate-pf ">
      <div class="blank-slate-pf-icon">
        <span class="pficon pficon-users"></span>
      </div>
      <h1>
        {{'No users found' | translate}}
      </h1>
      <p ng-if="!mode.isLegacy">
        {{'Check your LDAP or Active Directory settings' | translate}}
      </p>
    </div>
  </div>
  <wizard-step ng-if="wizard.isWizard" id="wizardStepBase"></wizard-step>
</div>

<div class="modal fade" id="bulkEdit" tabindex="-1" role="dialog" aria-labelledby="bulkEditLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          <span class="pficon pficon-close"></span>
        </button>
        <h4 class="modal-title" id="bulkEditLabel">{{'Edit selected extensions' | translate}}</h4>
      </div>
      <form class="form-horizontal" ng-submit="bulkEditSave()">
        <div class="modal-body">
          <div class="alert alert-info">
            <span class="pficon pficon-info"></span>
            <strong>{{'Locked fields will be left untouched' | translate}}.</strong>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-contest-bulk">{{'Context' | translate}}</label>
            <div class="col-sm-9">
              <div class="input-group">
                <div class="dropdown inline-display imp-full-size-max">
                  <button ng-disabled="bulkEdit.context == null" class="btn btn-default dropdown-toggle drd-button imp-full-size-max" type="button" id="textInput-contest-bulk" data-toggle="dropdown">
                      <span class="filter-option pull-left {{bulkEdit.context == null ? 'cursive' : ''}}">
                        {{temp.context ? temp.context : bulkEdit.context ? bulkEdit.context : bulkEdit.context == null ? 'This field will be left untouched' : '-' | translate}}
                      </span>
                    <span class="caret drd-carret"></span>
                  </button>
                  <ul class="dropdown-menu drd-ul imp-full-size-max" role="menu" aria-labelledby="textInput-contest-bulk">
                    <li><a ng-click="bulkEdit.context = ''" popover-placement="top" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{'Empty field' | translate}}">-</a></li>
                    <li ng-repeat="c in contexts"><a ng-click="bulkEdit.context = c">{{c}}</a></li>
                  </ul>
                </div>
                <span ng-click="bulkEdit.context === null ? bulkEdit.context = '' : bulkEdit.context = null" popover-placement="top-right" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{bulkEdit.context === null ? 'Unlock field' : 'Lock field' | translate}}" class="input-group-addon btn btn-default">
                  <span class="fa {{bulkEdit.context === null ? 'fa-lock' : 'fa-unlock-alt'}}"></span>
                </span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-callWaiting-bulk">{{'Call waiting' | translate}}</label>
            <div class="col-sm-9">
              <div class="input-group">
                <div class="dropdown inline-display imp-full-size-max">
                  <button ng-disabled="bulkEdit.callwaiting === null" class="btn btn-default dropdown-toggle drd-button imp-full-size-max" type="button" id="textInput-callWaiting-bulk" data-toggle="dropdown">
                    <span class="filter-option pull-left {{bulkEdit.callwaiting == null ? 'cursive' : ''}}">
                      {{bulkEdit.callwaiting === true ? 'Enabled' : bulkEdit.callwaiting === false ? 'Disabled' : bulkEdit.callwaiting === null ? 'This field will be left untouched' : '-' | translate}}
                    </span>
                  <span class="caret drd-carret"></span>
                  </button>
                  <ul class="dropdown-menu drd-ul imp-full-size-max" role="menu" aria-labelledby="textInput-callWaiting-bulk">
                    <li><a ng-click="bulkEdit.callwaiting = true">{{'Enabled' | translate}}</a></li>
                    <li><a ng-click="bulkEdit.callwaiting = false">{{'Disabled' | translate}}</a></li>
                  </ul>
                </div>
                <span ng-click="bulkEdit.callwaiting === null ? bulkEdit.callwaiting = '' : bulkEdit.callwaiting = null" popover-placement="top-right" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{bulkEdit.callwaiting === null ? 'Unlock field' : 'Lock field' | translate}}" class="input-group-addon btn btn-default">
                  <span class="fa {{bulkEdit.callwaiting === null ? 'fa-lock' : 'fa-unlock-alt'}}"></span>
                </span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-ringingtime-bulk">{{'Ringing time' | translate}}</label>
            <div class="col-sm-9">
              <div class="input-group">
                <input required placeholder="{{ bulkEdit.ringtime === null ? 'This field will be left untouched ' : '' | translate}}" ng-disabled="bulkEdit.ringtime === null" ng-model="bulkEdit.ringtime" popover-placement="top-left" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{bulkEdit.ringtime === 0 ? '0 = infinite' : '' | translate}}" type="number" class="form-control" id="textInput-ringingtime-bulk" min="0" max="120">
                <span ng-click="bulkEdit.ringtime === null ? bulkEdit.ringtime = '' : bulkEdit.ringtime = null" popover-placement="top-right" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{bulkEdit.ringtime === null ? 'Unlock field' : 'Lock field' | translate}}" class="input-group-addon btn btn-default">
                  <span class="fa {{bulkEdit.ringtime === null ? 'fa-lock' : 'fa-unlock-alt'}}"></span>
                </span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-callgroup-bulk">{{'Callgroup' | translate}}</label>
            <div class="col-sm-9">
              <div class="input-group">
                <input placeholder="{{ bulkEdit.callgroup === null ? 'This field will be left untouched ' : '' | translate}}" ng-disabled="bulkEdit.callgroup === null" ng-model="bulkEdit.callgroup" type="text" id="textInput-callgroup-bulk" class="form-control">
                <span ng-click="bulkEdit.callgroup === null ? bulkEdit.callgroup = '' : bulkEdit.callgroup = null" popover-placement="top-right" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{bulkEdit.callgroup === null ? 'Unlock field' : 'Lock field' | translate}}" class="input-group-addon btn btn-default">
                  <span class="fa {{bulkEdit.callgroup === null ? 'fa-lock' : 'fa-unlock-alt'}}"></span>
                </span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-pickupgroup-bulk">{{'Pickupgroup' | translate}}</label>
            <div class="col-sm-9">
              <div class="input-group">
                <input placeholder="{{ bulkEdit.pickupgroup === null ? 'This field will be left untouched ' : '' | translate}}" ng-disabled="bulkEdit.pickupgroup === null" ng-model="bulkEdit.pickupgroup" type="text" id="textInput-pickupgroup-bulk" class="form-control">
                <span ng-click="bulkEdit.pickupgroup === null ? bulkEdit.pickupgroup = '' : bulkEdit.pickupgroup = null" popover-placement="top-right" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{bulkEdit.pickupgroup === null ? 'Unlock field' : 'Lock field' | translate}}"  class="input-group-addon btn btn-default">
                  <span class="fa {{bulkEdit.pickupgroup === null ? 'fa-lock' : 'fa-unlock-alt'}}"></span>
                </span>
              </div>
            </div>
          </div>
          <!-- <div class="form-group">
            <button class="btn btn-default" type="button"><i class="fa fa-lock"></i></button>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-directdidmodule-bulk">{{'Direct did module' | translate}}</label>
            <div class="col-sm-9">
              <input type="checkbox" bs-switch ng-model="bulkEdit.directdidmodule" class="bootstrap-switch bootstrap-switch-permission" id="textInput-directdidmodule-bulk"></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-directdidroot-bulk">{{'Direct did root' | translate}}</label>
            <div class="col-sm-9">
              <input ng-model="bulkEdit.directdid.root" type="text" id="textInput-directdidroot-bulk" class="form-control"></div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="textInput-directdidvariable-bulk">{{'Direct did variable' | translate}}</label>
            <div class="col-sm-9">
              <input ng-model="bulkEdit.directdid.variable" type="text" id="textInput-directdidvariable-bulk" class="form-control"></div>
          </div>-->
          <div class="form-divider-row">
            <span class="fa {{temp.advancedOptions == true ? 'fa-angle-down' : 'fa-angle-right'}}"></span>
            <a class="inline-display form-divider-string" ng-click="temp.advancedOptions == true ? temp.advancedOptions = false : temp.advancedOptions = true">{{temp.advancedOptions == true ? 'Hide advanced options' : 'Show advanced options' | translate}}</a>
            <hr class="inline-hr"/>
          </div>
          <div ng-show="temp.advancedOptions" id="bulk-advanced-options">
            <div class="form-group">
              <label class="col-sm-3 control-label" for="textInput-pickupgroup-bulk"> </label>
              <div class="col-sm-9">
                <div class="input-group">
                  <strong>{{"Optional destinations" | translate}}:</strong>
                </div>
              </div>
            </div>
            <div ng-repeat="(destKey, destVal) in selectDest">
              <div class="form-group">
                <label class="col-sm-3 control-label" for="selectInput-{{destKey}}-bulk" title="{{destVal.label + ' destination' | translate}}">{{destVal.label | translate}}</label>
                <div class="col-sm-9">
                  <div class="input-group">
                    <div class="dropdown inline-display imp-full-size-max">
                      <button ng-disabled="bulkEdit[destKey] === null" class="btn btn-default dropdown-toggle drd-button imp-full-size-max" type="button" id="selectInput-{{destKey}}-bulk" data-toggle="dropdown">
                        <span class="filter-option pull-left {{bulkEdit[destKey] === null ? 'cursive' : ''}}">
                          {{selectDest[destKey].key ? selectDest[destKey].key : bulkEdit[destKey] === null ? 'This field will be left untouched' : '-' | translate}}
                        </span>
                        <span class="caret drd-carret"></span>
                      </button>
                      <ul class="dropdown-menu drd-ul imp-full-size-max" role="menu" aria-labelledby="textInput-contest-bulk">
                        <li><a ng-click="resetDest(destKey)" popover-placement="top" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{'Empty field' | translate}}">-</a></li>
                        <li ng-repeat="(k, v) in dest" ng-if="v.length > 1 || v[1] != undefined"><a ng-click="setDest(k, v, destKey)">{{k | translate}}</a></li>
                      </ul>
                    </div>
                    <span ng-click="bulkEdit[destKey] === null ? resetDest(destKey, '') : resetDest(destKey, null)" popover-placement="top-right" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{bulkEdit[destKey] === null ? 'Unlock field' : 'Lock field' | translate}}" class="input-group-addon btn btn-default">
                      <span class="fa {{bulkEdit[destKey] === null ? 'fa-lock' : 'fa-unlock-alt'}}"></span>
                    </span>
                  </div>
                </div>
              </div>
              <div ng-if="!(selectDest[destKey].value | isEmpty)" class="form-group">
                <label class="col-sm-3 control-label" for="selectInput-{{destKey}}item-bulk"> </label>
                <div class="col-sm-9">
                  <div class="dropdown inline-display imp-full-size-max right-padding">
                    <button class="btn btn-default dropdown-toggle drd-button imp-full-size-max"  type="button" id="selectInput-{{destKey}}item-bulk" data-toggle="dropdown">
                      <span class="filter-option pull-left">
                        {{selectDest[destKey].selected ? selectDest[destKey].selected : '-' | translate}}
                      </span>
                      <span class="caret drd-carret"></span>
                    </button>
                    <ul class="dropdown-menu drd-ul imp-full-size-max" role="menu" aria-labelledby="textInput-contest-bulk">
                      <li><a ng-click="resetDestVal(destKey)" popover-placement="top" popover-trigger="'mouseenter'" popover-animation="true" uib-popover="{{'Empty field' | translate}}">-</a></li>
                      <li ng-repeat="(k, v) in selectDest[destKey].value" ng-if="k != '99999'"><a ng-click="setDestVal(k, destKey)">{{v.description | translate}}</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div ng-show="temp.onsave" class="spinner spinner-sm adjust-margin loader-modal"></div>
        <div class="modal-footer submit">
          <button type="button" class="btn btn-default" data-dismiss="modal">{{'Cancel' | translate}}</button>
          <button type="submit" class="btn btn-primary">{{'Save' | translate}}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="setInterval" tabindex="-1" role="dialog" aria-labelledby="intervalButton" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          <span class="pficon pficon-close"></span>
        </button>
        <h4 class="modal-title" id="setIntervalLabel">{{'Interval' | translate}}</h4>
      </div>
      <form class="form-horizontal" ng-submit="selectInterval()">
        <div class="modal-body">
          <div class="form-group">
            <label class="col-sm-3 control-label" for="frominterval-modal-markup">{{'From' | translate}}</label>
            <div class="col-sm-9">
              <input ng-model="interval.from" type="number" id="frominterval-modal-markup" class="form-control" min="0">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="tointerval-modal-markup">{{'To' | translate}}</label>
            <div class="col-sm-9">
              <input ng-model="interval.to" type="number" id="tointerval-modal-markup" class="form-control" min="0">
            </div>
          </div>
        </div>
        <div ng-show="onSave" class="spinner spinner-sm adjust-margin loader-modal"></div>
        <div class="modal-footer submit">
          <button type="button" class="btn btn-default" data-dismiss="modal">{{'Cancel' | translate}}</button>
          <button type="submit" class="btn btn-primary">{{'Save' | translate}}</button>
        </div>
      </form>
    </div>
  </div>
</div>
